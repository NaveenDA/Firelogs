(()=>{"use strict";class e{static storage=chrome.storage.local;static log=e=>{"object"==typeof e&&(e=JSON.stringify(e)),chrome.tabs.executeScript({code:"console.log(`"+e+"`)"})};static count=e=>{"object"==typeof e&&(e=JSON.stringify(e)),chrome.tabs.executeScript({code:"console.count(`"+e+"`)"})}}const t=e,o=class{static loadFireLogs(e){t.log("ðŸš€Firelogs is loading... on tab_id:"+e),t.storage.set({activeTab:{id:e}}),chrome.tabs.executeScript(null,{file:"dist/firelogs.js"},(()=>{t.log("Script is loaded...")}))}static destoryFireLogs(e){t.log("ðŸ’¥Destorying firelogs..."+e?.id),t.storage.remove("activeTab"),t.storage.remove("firelogsCount"),e&&(chrome.tabs.update(e.id,{selected:!0}),chrome.windows.update(e.windowId,{focused:!0})),chrome.tabs.executeScript({code:"\n      try{\n        console.log(\"Hello\")\n        document.querySelector('#__firelogs').remove();\n      }catch(e){}\n      "})}static addCount(){t.storage.get("firelogsCount",(function({firelogsCount:e}){e||(e={count:0}),t.storage.set({firelogsCount:{count:e.count+1}},(()=>{t.log(e.count+1),chrome.tabs.executeScript({code:"\n              try{\n                document.querySelector('#__firelogs #add-count').click();\n              }catch(e){}\n            "})}))}))}},r=class{static onCompleted(e,r,s){e.tabId&&r==e.tabId&&"xmlhttprequest"===e.type&&(t.count("onCompleted"),t.log(e),o.addCount())}static onErrorOccurred(e,r,s){e.tabId&&r==e.tabId&&"xmlhttprequest"===e.type&&(t.count("onErrorOccurred"),t.log(e),o.addCount())}static destory(e){}};let s,c,a,i;const d=e=>{l((t=>{r.onCompleted(e,t,c)}))};let n;const l=e=>{n||t.storage.get("activeTab",(function({activeTab:e}){n=e.id})),e(n)};chrome.tabs.onUpdated.addListener((function(e,r,s){if("complete"==r.status&&s.active){var c={id:s.id};t.storage.get("activeTab",(function({activeTab:e}){e&&e.id===c.id&&(i=s,t.log({activeTabContext:i}),a=s.id,o.loadFireLogs(s.id),t.log({load:1}))}))}})),chrome.browserAction.onClicked.addListener((function(e){i=e;var r=e.id;t.storage.get("activeTab",(function({activeTab:c}){c?c.id===r?chrome.tabs.remove(s.id):(o.loadFireLogs(e.id),t.log({load:2})):(o.loadFireLogs(e.id),t.log({load:3}))}))})),chrome.runtime.onMessage.addListener(((e,n,l)=>{switch(e){case"open-firelogs-tab:hidden-mode":case"open-firelogs-tab":s?"open-firelogs-tab"===e&&(chrome.tabs.update(s.id,{selected:!0}),chrome.windows.update(s.windowId,{focused:!0})):chrome.tabs.create({url:chrome.extension.getURL("dist/firelogs.html")},(function(e){s=e,l(e),chrome.tabs.onRemoved.addListener((()=>{s=null,c=null,a=null,t.storage.remove("firelogsCount"),o.destoryFireLogs(i),i=null,chrome.webRequest.onCompleted.removeListener(d)})),chrome.webRequest.onCompleted.addListener(d,{urls:["<all_urls>"]},["responseHeaders"]),chrome.webRequest.onErrorOccurred.addListener((e=>{r.onErrorOccurred(e,a,c)}),{urls:["<all_urls>"]},["extraHeaders"])}));default:return!0}}))})();